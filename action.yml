name: "Preevy Up"
description: "Runs the Preevy `up` command"
author: "Livecycle"
inputs:
  profile-url:
    required: true
    description: "The Preevy profile URL"
  args:
    required: false
    description: "Additional args to provide to the `up` command."
  docker-compose-yaml-path:
    required: false
    description: "The path to the docker compose file. Uses current working directory if not provided."
outputs:
  urls-markdown:
    description: "The generated URLs of the preview environments create by Preevy, formatted as a markdown table"
    value: ${{ steps.run_preevy.outputs.urls-markdown }}
  urls-json:
    description: "The generated URLs of the preview environments create by Preevy, formatted as a markdown table"
    value: ${{ steps.run_preevy.outputs.urls-json }}
runs:
  using: "composite"
  steps:
    - uses: actions/setup-node@v3
      with:
        node-version: 18
    - name: Install the Preevy CLI
      shell: bash
      run: npm i -g preevy
    - name: Initialize Preevy
      shell: bash
      run: preevy init --from ${{ inputs.profile-url }}
    - run: echo "${{ github.action_path }}" >> $GITHUB_PATH
      shell: bash
    - name: Run Preevy
      shell: bash
      id: run_preevy
      run: up.sh
